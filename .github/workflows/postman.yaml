name: Postman Workflow Template

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]
  workflow_dispatch:

jobs:
  lint-and-test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - uses: actions/setup-node@v4
        with:
          node-version: "20"
          cache: "npm"

      - name: Install dependencies
        run: npm ci

      - name: Install Postman CLI
        run: curl -o- "https://dl-cli.pstmn.io/install/unix.sh" | sh

      - name: Lint Postman collections with Spectral
        run: npm run lint:collections

      # TEMPLATE: Customize the steps below for your project

      # - name: Run your tests
      #   run: npm test

      # - name: Start your API server
      #   run: |
      #     npm start &
      #     sleep 5

      # - name: Run Postman collections
      #   env:
      #     POSTMAN_API_KEY: ${{ secrets.POSTMAN_API_KEY }}
      #   run: |
      #     postman login --with-api-key "$POSTMAN_API_KEY"
      #     for collection in postman/collections/*.postman_collection.json; do
      #       postman collection run "$collection"
      #     done

      # - name: Publish to Postman workspace (optional)
      #   if: github.ref == 'refs/heads/main'
      #   env:
      #     POSTMAN_API_KEY: ${{ secrets.POSTMAN_API_KEY }}
      #   run: |
      #     postman login --with-api-key "$POSTMAN_API_KEY"
      #     postman workspace push -y

      - name: Success
        run: echo "âœ… Workflow completed! Customize this template for your project."
