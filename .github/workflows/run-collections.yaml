name: Run Postman Collections (Template)

# This is a TEMPLATE workflow. Customize it for your project.
# See docs/CI_CD.md for detailed instructions.

on:
  pull_request:
    branches: [main, develop]
  push:
    branches: [main, develop]
  workflow_dispatch:

jobs:
  run-collections:
    name: Run Postman Collections
    runs-on: ubuntu-latest

    # TEMPLATE: Uncomment to test on multiple Node versions
    # strategy:
    #   matrix:
    #     node-version: [18, 20]
    #   fail-fast: false

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Node.js
        # uses: actions/setup-node@v4
        # with:
        #   node-version: ${{ matrix.node-version }}
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'

      - name: Install dependencies
        run: npm ci

      - name: Install Postman CLI
        run: curl -o- "https://dl-cli.pstmn.io/install/unix.sh" | sh

      # TEMPLATE: Add your project-specific setup here
      # - name: Setup database
      #   run: |
      #     docker-compose up -d postgres
      #     npm run db:migrate

      # - name: Start API server
      #   run: |
      #     npm start &
      #     SERVER_PID=$!
      #     echo "SERVER_PID=$SERVER_PID" >> $GITHUB_ENV

      # - name: Wait for server
      #   run: |
      #     timeout 60 bash -c '
      #       until curl -f http://localhost:3000/health; do
      #         sleep 2
      #       done
      #     '

      - name: Authenticate with Postman
        env:
          POSTMAN_API_KEY: ${{ secrets.POSTMAN_API_KEY }}
        run: postman login --with-api-key "$POSTMAN_API_KEY"

      - name: Run Postman collections
        run: |
          echo "ðŸ“¬ Running Postman collections..."
          echo ""
          echo "âš ï¸  This is a template workflow."
          echo "Customize it to run your collections against your API."
          echo ""
          echo "Example:"
          echo "  postman collection run \\"
          echo "    postman/collections/your-api.postman_collection.json \\"
          echo "    --environment postman/environments/dev.postman_environment.json"
          echo ""

          # TEMPLATE: Uncomment and customize for your project
          # for collection in postman/collections/*.postman_collection.json; do
          #   if [ -f "$collection" ]; then
          #     echo "Running: $(basename "$collection")"
          #     postman collection run "$collection" \
          #       --environment postman/environments/dev.postman_environment.json \
          #       --reporter cli,json \
          #       --reporter-json-export "results-$(basename "$collection").json"
          #   fi
          # done

      # - name: Upload test results
      #   if: always()
      #   uses: actions/upload-artifact@v3
      #   with:
      #     name: postman-results
      #     path: results-*.json

      # - name: Stop server
      #   if: always()
      #   run: kill $SERVER_PID 2>/dev/null || true

      - name: Template reminder
        run: |
          echo "âœ… Template workflow completed!"
          echo ""
          echo "ðŸ“š To customize this workflow for your project:"
          echo "   1. Uncomment and configure the server setup steps"
          echo "   2. Update collection paths and environment files"
          echo "   3. Add your API's health check endpoint"
          echo "   4. See docs/CI_CD.md for detailed examples"
