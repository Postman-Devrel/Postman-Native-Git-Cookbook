openapi: 3.1.0
info:
  title: Intergalactic Bank API
  version: 1.0.0
  description: |
    The Intergalactic Bank API makes it easy to manage transaction and account data. 
    Whether you're running an ATM for Astronauts or simply interested in keeping tabs on 
    your Cosmic Coins, Intergalactic Bank has you covered with REST-based requests to make it happen.
    
    ## Features
    - **Account Management**: Create, read, update, and delete bank accounts
    - **Transaction Processing**: Transfer funds between accounts or deposit to accounts
    - **Multiple Currencies**: Support for COSMIC_COINS, GALAXY_GOLD, and MOON_BUCKS
    - **API Key Authentication**: Secure endpoints with API key validation
    - **Rate Limiting**: 300 requests per minute per API key
    
  contact:
    name: Intergalactic Bank Support
    url: https://intergalacticbank.example.com/support
  license:
    name: ISC
    url: https://opensource.org/licenses/ISC

servers:
  - url: http://localhost:3000
    description: Local development server
  - url: https://api.intergalacticbank.example.com
    description: Production server
  - url: https://template.postman-echo.com
    description: Demo server

tags:
  - name: Admin
    description: Administrative operations including API key management
  - name: Accounts
    description: |
      Account management operations. An account at the Intergalactic Bank allows you to store funds.
      Use these endpoints to list, create, update, and delete accounts.
  - name: Transactions
    description: |
      Transaction operations. A transaction records money moving in or out of an account.
      Transactions at the Galactic Bank follow a blockchain-like approach. Once created, 
      they cannot be updated or deleted.

security:
  - ApiKeyAuth: []

paths:
  /api/v1/auth:
    get:
      tags:
        - Admin
      summary: Generate API key
      description: |
        Generates a new API key for accessing the Intergalactic Bank APIsss.
        This endpoint does not require authentication.
      operationId: generateApiKey
      security: []
      responses:
        '200':
          description: Successful API key generation
          headers:
            X-RateLimit-Limit:
              $ref: '#/components/headers/X-RateLimit-Limit'
            X-RateLimit-Remaining:
              $ref: '#/components/headers/X-RateLimit-Remaining'
            X-RateLimit-Reset:
              $ref: '#/components/headers/X-RateLimit-Reset'
          content:
            application/json:
              schema:
                type: object
                required:
                  - apiKey
                properties:
                  apiKey:
                    type: string
                    description: The generated API key
                    example: "123456789"
        '500':
          $ref: '#/components/responses/InternalServerError'

  /api/v1/accounts:
    get:
      tags:
        - Accounts
      summary: List all accounts
      description: |
        Retrieves a list of all accounts at the Intergalactic Bank. 
        Optionally filter by owner name or creation date.
      operationId: listAccounts
      parameters:
        - name: owner
          in: query
          description: Filter accounts by owner's full name
          required: false
          schema:
            type: string
          example: "Nova Newman"
        - name: createdAt
          in: query
          description: Filter accounts by creation date (YYYY-MM-DD format)
          required: false
          schema:
            type: string
            format: date
          example: "2023-04-10"
      responses:
        '200':
          description: Successful response with list of accounts
          headers:
            X-RateLimit-Limit:
              $ref: '#/components/headers/X-RateLimit-Limit'
            X-RateLimit-Remaining:
              $ref: '#/components/headers/X-RateLimit-Remaining'
            X-RateLimit-Reset:
              $ref: '#/components/headers/X-RateLimit-Reset'
          content:
            application/json:
              schema:
                type: object
                required:
                  - accounts
                properties:
                  accounts:
                    type: array
                    items:
                      $ref: '#/components/schemas/Account'
              examples:
                withResults:
                  summary: Accounts found
                  value:
                    accounts:
                      - accountId: "1"
                        owner: "Nova Newman"
                        createdAt: "2023-04-10"
                        balance: 10000
                        currency: "COSMIC_COINS"
                      - accountId: "2"
                        owner: "Gary Galaxy"
                        createdAt: "2023-04-10"
                        balance: 237
                        currency: "COSMIC_COINS"
                noResults:
                  summary: No accounts found
                  value:
                    accounts: []
        '401':
          $ref: '#/components/responses/Unauthorized'
        '429':
          $ref: '#/components/responses/RateLimitExceeded'
        '500':
          $ref: '#/components/responses/InternalServerError'
    
    post:
      tags:
        - Accounts
      summary: Create new account
      description: |
        Creates a new account at the Intergalactic Bank. The account will be assigned a unique ID.
        The currency cannot be changed once the account is created.
      operationId: createAccount
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateAccountRequest'
            examples:
              withBalance:
                summary: Create account with initial balance
                value:
                  owner: "Nova Newman"
                  balance: 500
                  currency: "COSMIC_COINS"
              withoutBalance:
                summary: Create account with zero balance
                value:
                  owner: "Luna Starlight"
                  currency: "GALAXY_GOLD"
      responses:
        '201':
          description: Account created successfully
          headers:
            X-RateLimit-Limit:
              $ref: '#/components/headers/X-RateLimit-Limit'
            X-RateLimit-Remaining:
              $ref: '#/components/headers/X-RateLimit-Remaining'
            X-RateLimit-Reset:
              $ref: '#/components/headers/X-RateLimit-Reset'
          content:
            application/json:
              schema:
                type: object
                required:
                  - account
                properties:
                  account:
                    type: object
                    required:
                      - accountId
                    properties:
                      accountId:
                        type: string
                        description: The unique identifier of the created account
              example:
                account:
                  accountId: "123"
        '400':
          $ref: '#/components/responses/ValidationError'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '429':
          $ref: '#/components/responses/RateLimitExceeded'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /api/v1/transactions:
    get:
      tags:
        - Transactions
      summary: List all transactions
      description: |
        Retrieves a list of transactions. Optionally filter by source account, 
        destination account, or creation date.
      operationId: listTransactions
      parameters:
        - name: fromAccountId
          in: query
          description: Filter transactions by source account ID
          required: false
          schema:
            type: string
          example: "11111111"
        - name: toAccountId
          in: query
          description: Filter transactions by destination account ID
          required: false
          schema:
            type: string
          example: "18974440"
        - name: createdAt
          in: query
          description: Filter transactions by creation date (YYYY-MM-DD format)
          required: false
          schema:
            type: string
            format: date
          example: "2024-01-10"
      responses:
        '200':
          description: Successful response with list of transactions
          headers:
            X-RateLimit-Limit:
              $ref: '#/components/headers/X-RateLimit-Limit'
            X-RateLimit-Remaining:
              $ref: '#/components/headers/X-RateLimit-Remaining'
            X-RateLimit-Reset:
              $ref: '#/components/headers/X-RateLimit-Reset'
          content:
            application/json:
              schema:
                type: object
                required:
                  - transactions
                properties:
                  transactions:
                    type: array
                    items:
                      $ref: '#/components/schemas/Transaction'
              examples:
                withResults:
                  summary: Transactions found
                  value:
                    transactions:
                      - transactionId: "1"
                        createdAt: "2024-01-10"
                        amount: 94857902
                        currency: "COSMIC_COINS"
                        fromAccountId: "11111111"
                        toAccountId: "18974440"
                      - transactionId: "2"
                        createdAt: "2024-01-10"
                        amount: 10000
                        currency: "COSMIC_COINS"
                        fromAccountId: "11111111"
                        toAccountId: "18974440"
                noResults:
                  summary: No transactions found
                  value:
                    transactions: []
        '401':
          $ref: '#/components/responses/Unauthorized'
        '429':
          $ref: '#/components/responses/RateLimitExceeded'
        '500':
          $ref: '#/components/responses/InternalServerError'
    
    post:
      tags:
        - Transactions
      summary: Create new transaction
      description: |
        Creates a new transaction. There are two types of transactions:
        - **Transfer**: Move funds between two accounts by providing valid account IDs
        - **Deposit**: Add money to an account by using "0" as the fromAccountId
        
        **Important**: Transactions cannot be edited or deleted once created.
      operationId: createTransaction
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateTransactionRequest'
            examples:
              transfer:
                summary: Transfer between accounts
                value:
                  fromAccountId: "12345678"
                  toAccountId: "87654321"
                  amount: 10000
                  currency: "COSMIC_COINS"
              deposit:
                summary: Deposit to account
                value:
                  fromAccountId: "0"
                  toAccountId: "87654321"
                  amount: 10000
                  currency: "COSMIC_COINS"
      responses:
        '201':
          description: Transaction created successfully
          headers:
            X-RateLimit-Limit:
              $ref: '#/components/headers/X-RateLimit-Limit'
            X-RateLimit-Remaining:
              $ref: '#/components/headers/X-RateLimit-Remaining'
            X-RateLimit-Reset:
              $ref: '#/components/headers/X-RateLimit-Reset'
          content:
            application/json:
              schema:
                type: object
                required:
                  - transaction
                properties:
                  transaction:
                    type: object
                    required:
                      - transactionId
                    properties:
                      transactionId:
                        type: string
                        description: The unique identifier of the created transaction
              example:
                transaction:
                  transactionId: "123"
        '400':
          $ref: '#/components/responses/ValidationError'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/InsufficientFunds'
        '404':
          $ref: '#/components/responses/AccountNotFound'
        '429':
          $ref: '#/components/responses/RateLimitExceeded'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /api/v1/transactions/{transactionId}:
    get:
      tags:
        - Transactions
      summary: Get transaction by ID
      description: Retrieves detailed information about a specific transaction by its ID.
      operationId: getTransaction
      parameters:
        - $ref: '#/components/parameters/TransactionId'
      responses:
        '200':
          description: Transaction details retrieved successfully
          headers:
            X-RateLimit-Limit:
              $ref: '#/components/headers/X-RateLimit-Limit'
            X-RateLimit-Remaining:
              $ref: '#/components/headers/X-RateLimit-Remaining'
            X-RateLimit-Reset:
              $ref: '#/components/headers/X-RateLimit-Reset'
          content:
            application/json:
              schema:
                type: object
                required:
                  - transaction
                properties:
                  transaction:
                    $ref: '#/components/schemas/Transaction'
              example:
                transaction:
                  transactionId: "1"
                  createdAt: "2024-01-10"
                  amount: 10000
                  currency: "COSMIC_COINS"
                  fromAccountId: "11111111"
                  toAccountId: "22222222"
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/TransactionNotFound'
        '429':
          $ref: '#/components/responses/RateLimitExceeded'
        '500':
          $ref: '#/components/responses/InternalServerError'

components:
  securitySchemes:
    ApiKeyAuth:
      type: apiKey
      in: header
      name: x-api-key
      description: |
        API key for authentication. Include your API key in the `x-api-key` header.
        Generate a new API key using the `/api/v1/auth` endpoint.
        
        Admin operations require the admin API key (default: "1234").

  parameters:
    AccountId:
      name: accountId
      in: path
      required: true
      description: The unique identifier of the account
      schema:
        type: string
      example: "123"
    
    TransactionId:
      name: transactionId
      in: path
      required: true
      description: The unique identifier of the transaction
      schema:
        type: string
      example: "1"

  headers:
    X-RateLimit-Limit:
      description: The maximum number of requests permitted per minute
      schema:
        type: integer
        example: 300
    
    X-RateLimit-Remaining:
      description: The number of requests remaining in the current rate limit window
      schema:
        type: integer
        example: 299
    
    X-RateLimit-Reset:
      description: The time at which the current rate limit window resets (UTC epoch seconds)
      schema:
        type: integer
        example: 1678901234

  schemas:
    Account:
      type: object
      required:
        - accountId
        - owner
        - createdAt
        - balance
        - currency
      properties:
        accountId:
          type: string
          description: Unique identifier for the account
          example: "1"
        owner:
          type: string
          description: Full name of the account owner
          minLength: 1
          example: "Nova Newman"
        createdAt:
          type: string
          format: date
          description: Date the account was created (YYYY-MM-DD)
          example: "2023-04-10"
        balance:
          type: number
          format: double
          description: Current account balance
          minimum: 0
          example: 10000
        currency:
          type: string
          description: Currency type for the account
          enum:
            - COSMIC_COINS
            - GALAXY_GOLD
            - MOON_BUCKS
          example: "COSMIC_COINS"
    
    CreateAccountRequest:
      type: object
      required:
        - owner
        - currency
      properties:
        owner:
          type: string
          description: Full name of the account owner
          minLength: 1
          example: "Nova Newman"
        balance:
          type: number
          format: double
          description: Initial account balance (defaults to 0 if not provided)
          minimum: 0
          default: 0
          example: 500
        currency:
          type: string
          description: Currency type for the account (cannot be changed after creation)
          enum:
            - COSMIC_COINS
            - GALAXY_GOLD
            - MOON_BUCKS
          example: "COSMIC_COINS"
    
    UpdateAccountRequest:
      type: object
      required:
        - owner
      properties:
        owner:
          type: string
          description: Updated full name of the account owner
          minLength: 1
          example: "Nova Newman"
    
    Transaction:
      type: object
      required:
        - transactionId
        - createdAt
        - amount
        - currency
        - fromAccountId
        - toAccountId
      properties:
        transactionId:
          type: string
          description: Unique identifier for the transaction
          example: "1"
        createdAt:
          type: string
          format: date
          description: Date the transaction was created (YYYY-MM-DD)
          example: "2024-01-10"
        amount:
          type: number
          format: double
          description: Transaction amount
          minimum: 0
          exclusiveMinimum: true
          example: 10000
        currency:
          type: string
          description: Currency type for the transaction
          enum:
            - COSMIC_COINS
            - GALAXY_GOLD
            - MOON_BUCKS
          example: "COSMIC_COINS"
        fromAccountId:
          type: string
          description: Source account ID (use "0" for deposits from external source)
          example: "11111111"
        toAccountId:
          type: string
          description: Destination account ID
          example: "22222222"
    
    CreateTransactionRequest:
      type: object
      required:
        - fromAccountId
        - toAccountId
        - amount
        - currency
      properties:
        fromAccountId:
          type: string
          description: Source account ID (use "0" for deposits from external source)
          example: "12345678"
        toAccountId:
          type: string
          description: Destination account ID
          example: "87654321"
        amount:
          type: number
          format: double
          description: Transaction amount (must be positive)
          minimum: 0
          exclusiveMinimum: true
          example: 10000
        currency:
          type: string
          description: Currency type (must match account currencies)
          enum:
            - COSMIC_COINS
            - GALAXY_GOLD
            - MOON_BUCKS
          example: "COSMIC_COINS"
    
    Error:
      type: object
      required:
        - error
      properties:
        error:
          type: object
          required:
            - name
            - message
          properties:
            name:
              type: string
              description: Error type identifier
              example: "validationError"
            message:
              type: string
              description: Human-readable error message
              example: "Owner name is required and must be a string"

  responses:
    Unauthorized:
      description: Authentication required or API key invalid
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            error:
              name: "authenticationError"
              message: "API key is required. Please provide an API key in the x-api-key header."
    
    Forbidden:
      description: Insufficient permissions to perform this operation
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          examples:
            adminRequired:
              summary: Admin access required
              value:
                error:
                  name: "forbiddenError"
                  message: "You do not have permissions to perform this action. Admin access required."
            accountPermission:
              summary: Account permission denied
              value:
                error:
                  name: "forbiddenError"
                  message: "You do not have permissions to update this account."
    
    AccountNotFound:
      description: The specified account does not exist
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            error:
              name: "instanceNotFoundError"
              message: "The specified account does not exist."
    
    TransactionNotFound:
      description: The specified transaction does not exist
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            error:
              name: "instanceNotFoundError"
              message: "The specified transaction does not exist."
    
    ValidationError:
      description: Request validation failed
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          examples:
            missingField:
              summary: Missing required field
              value:
                error:
                  name: "validationError"
                  message: "Owner name is required and must be a string"
            invalidCurrency:
              summary: Invalid currency
              value:
                error:
                  name: "validationError"
                  message: "Currency must be one of: COSMIC_COINS, GALAXY_GOLD, MOON_BUCKS"
            negativeAmount:
              summary: Invalid amount
              value:
                error:
                  name: "validationError"
                  message: "Amount must be a positive number"
    
    InsufficientFunds:
      description: Insufficient funds to complete the transaction
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            error:
              name: "txInsufficientFunds"
              message: "Not enough funds in source account to complete transaction."
    
    RateLimitExceeded:
      description: Too many requests - rate limit exceeded
      headers:
        X-RateLimit-Limit:
          $ref: '#/components/headers/X-RateLimit-Limit'
        X-RateLimit-Remaining:
          schema:
            type: integer
            example: 0
        X-RateLimit-Reset:
          $ref: '#/components/headers/X-RateLimit-Reset'
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            error:
              name: "rateLimitExceeded"
              message: "Too many requests. Maximum 300 requests per minute allowed."
    
    InternalServerError:
      description: Internal server error
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            error:
              name: "serverError"
              message: "An unexpected error occurred"

